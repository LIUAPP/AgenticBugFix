FROM python:3.12-slim



ENV PYTHONDONTWRITEBYTECODE=1 \
	PYTHONUNBUFFERED=1 \
	POETRY_VIRTUALENVS_CREATE=false

WORKDIR /app

# Install build dependencies (only if a package requires compilation)
RUN apt-get update && apt-get install -y --no-install-recommends \
	build-essential \
	gcc \
	libffi-dev \
	git \
	&& rm -rf /var/lib/apt/lists/*

# Copy dependency manifest and install
COPY requirements.txt /app/
RUN pip install --upgrade pip setuptools wheel && \
	pip install --no-cache-dir -r /app/requirements.txt

# Copy application code
COPY AIAgentServer /app

# Create a non-root user and switch to it
RUN useradd --create-home --shell /bin/bash appuser && chown -R appuser:appuser /app
USER appuser

EXPOSE 8000

ENTRYPOINT ["python", "agent.py"]